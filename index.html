<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>CTF Platform</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet"/>
  <style>
    body{font-family:Inter;background:#1a202c;color:#fff;margin:0;padding:0;}
    .bg-gray-700{background:#4a5568;}
    .bg-gray-800{background:#2d3748;}
    .text-purple-400{color:#a78bfa;}
    .btn{display:inline-block;padding:.75rem 1.5rem;background:#7c3aed;color:#fff;border-radius:9999px;transition:.3s;}
    .btn:hover{background:#6d28d9;transform:scale(1.05);}
    .tab-active{border-bottom:2px solid #a78bfa;}
  </style>
</head>

<body class="min-h-screen flex flex-col">
  <!-- Header -->
  <header class="bg-gray-900 p-4 shadow-lg">
    <div class="container mx-auto max-w-6xl flex justify-between items-center">
      <h1 class="text-3xl font-bold text-purple-400">CTF Platform</h1>
      <nav class="flex space-x-6">
        <button onclick="switchTab('dashboard')" class="tab text-gray-300 hover:text-white" id="tab-dashboard">Dashboard</button>
        <button onclick="switchTab('scoreboard')" class="tab text-gray-300 hover:text-white" id="tab-scoreboard">Scoreboard</button>
        <button onclick="switchTab('charts')" class="tab text-gray-300 hover:text-white" id="tab-charts">Charts</button>
      </nav>
    </div>
  </header>

  <!-- Main -->
  <main id="app" class="flex-grow p-8 bg-gray-800"></main>

  <footer class="bg-gray-900 text-center p-4 text-sm text-gray-400">
    ¬© <span id="yr"></span> CTF Platform
  </footer>

  <script type="module">
    const ALL_CATEGORIES = [
      'Web Exploitation','Networking','Forensics','Mobile Exploitation',
      'Cryptography','Reverse Engineering','Binary Exploitation','Miscellaneous'
    ];
    const loadJSON = url => fetch(url).then(r => r.json());

    /* ---------- tabs ---------- */
    const TABS = ['dashboard','scoreboard','charts'];
    function switchTab(tab){
      TABS.forEach(t=>document.getElementById('tab-'+t).classList.remove('tab-active'));
      document.getElementById('tab-'+tab).classList.add('tab-active');
      render(tab);
    }

    /* ---------- views ---------- */
    async function render(tab){
      const app=document.getElementById('app');
      switch(tab){
        case 'dashboard':{
          const ch=await loadJSON('./data/challenges.json');
          const counts={};ALL_CATEGORIES.forEach(c=>counts[c]=0);
          ch.forEach(c=>counts[c.category]++);
          app.innerHTML=`
            <h2 class="text-4xl font-extrabold text-center mb-8">Challenge Categories</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 max-w-6xl mx-auto">
            ${ALL_CATEGORIES.map(cat=>{
              const icon=cat==='Web Exploitation'?'üï∏Ô∏è':cat==='Networking'?'üåê':cat==='Forensics'?'üî¨':cat==='Mobile Exploitation'?'üì±':cat==='Cryptography'?'üîë':cat==='Reverse Engineering'?'‚öôÔ∏è':cat==='Binary Exploitation'?'üíª':'‚ùì';
              return`
                <div class="bg-gray-700 rounded-xl p-6 text-center cursor-pointer hover:scale-105 transition transform"
                     onclick="openCategory('${cat}')">
                  <div class="text-5xl mb-4 text-purple-400">${icon}</div>
                  <h3 class="text-2xl font-semibold mb-2">${cat}</h3>
                  <p class="text-gray-300">${counts[cat]} Challenges</p>
                </div>`;
            }).join('')}
            </div>`;
          break;
        }
        case 'scoreboard':{
          const scores=JSON.parse(localStorage.getItem('scores')||'[]');
          const players={};scores.forEach(s=>{
            if(!players[s.player])players[s.player]={solved:0,points:0};
            players[s.player].solved++;players[s.player].points+=s.pts;
          });
          const sorted=Object.entries(players).sort((a,b)=>b[1].points-a[1].points);
          app.innerHTML=`
            <h2 class="text-4xl font-extrabold text-center mb-8">Scoreboard</h2>
            <div class="bg-gray-700 rounded-xl overflow-x-auto max-w-4xl mx-auto">
              <table class="w-full text-left">
                <thead>
                  <tr class="border-b border-gray-600">
                    <th class="p-3">#</th><th class="p-3">Player</th><th class="p-3">Solved</th><th class="p-3">Points</th>
                  </tr>
                </thead>
                <tbody>
                ${sorted.map(([p,d],i)=>`
                  <tr class="border-b border-gray-600">
                    <td class="p-3">${i+1}</td>
                    <td class="p-3 font-mono text-purple-300">${p}</td>
                    <td class="p-3">${d.solved}</td>
                    <td class="p-3 font-bold text-green-400">${d.points}</td>
                  </tr>`).join('')}
                </tbody>
              </table>
            </div>`;
          break;
        }
        case 'charts':{
          const ch=await loadJSON('./data/challenges.json');
          const scores=JSON.parse(localStorage.getItem('scores')||'[]');
          const totalByCat={};const solvedByCat={};
          ALL_CATEGORIES.forEach(c=>{totalByCat[c]=0;solvedByCat[c]=0;});
          ch.forEach(c=>totalByCat[c.category]++);
          scores.forEach(s=>{
            const cat=ch.find(c=>c.id===s.cid).category;solvedByCat[cat]++;
          });
          app.innerHTML=`
            <h2 class="text-4xl font-extrabold text-center mb-8">Statistics</h2>
            <div class="space-y-6 max-w-4xl mx-auto">
            ${ALL_CATEGORIES.map(cat=>{
              const pct=totalByCat[cat] ? Math.round(solvedByCat[cat]/totalByCat[cat]*100) : 0;
              return`
                <div class="bg-gray-700 rounded-xl p-4">
                  <div class="flex justify-between mb-1">
                    <span class="font-semibold">${cat}</span>
                    <span class="text-purple-300">${solvedByCat[cat]} / ${totalByCat[cat]}</span>
                  </div>
                  <div class="w-full bg-gray-600 rounded-full h-2.5">
                    <div class="bg-purple-500 h-2.5 rounded-full" style="width:${pct}%"></div>
                  </div>
                </div>`;
            }).join('')}
            </div>`;
          break;
        }
      }
    }

    /* ---------- category drill-down ---------- */
    window.openCategory = async function(cat){
      const ch=await loadJSON('./data/challenges.json');
      const list=ch.filter(c=>c.category===cat);
      const app=document.getElementById('app');
      app.innerHTML=`
        <button class="btn mb-6" onclick="switchTab('dashboard')">‚Üê Back</button>
        <h2 class="text-3xl font-bold mb-6">${cat}</h2>
        <div class="grid gap-6">
        ${list.map(c=>{
          const solved=JSON.parse(localStorage.getItem('scores')||'[]').some(s=>s.cid===c.id);
          return`
            <div class="bg-gray-700 rounded-xl p-6 flex justify-between items-center ${solved?'border-2 border-green-500':''}">
              <div>
                <h3 class="text-xl font-semibold">${c.title}</h3>
                <p class="text-gray-300">${c.points} pts</p>
              </div>
              <a class="btn" href="./challenges/web/${c.id}.html">Solve</a>
            </div>`;
        }).join('')}
        </div>`;
    }

    /* ---------- init ---------- */
    switchTab('dashboard');
    document.getElementById('yr').textContent=new Date().getFullYear();
  </script>
</body>
</html>
